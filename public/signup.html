<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Smooch+Sans:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="logstyle.css" />
    <script src="scriptLightDark.js"></script>
    <title>Sign up Page</title>
</head>
<body class="body_Signup">
    <img id="imgLightDark" src="imgLightDark.png"></img>
    <div class="container" id="signcont">
        <h1 id="title">Sign Up</h1>
        <form id="signupForm">
            <div class="user">
                <!-- Campo de Usuario -->
                <input type="email" placeholder="Email ID" id="userfield" required />
            </div>
            <div class="password">
                <!-- Campo de Contraseña -->
                <input type="password" placeholder="Password" id="psswrdfield" required />
            </div>
            <div class="passwordconfirm">
                <!-- Campo de Confirmación de Contraseña -->
                <input
                    type="password"
                    placeholder="Confirm Password"
                    id="psswrdconfirm"
                    required
                />
            </div>
            <button type="button" id="signupbtn">Sign Up</button>
            <div id="errorMessage" class="error-message"></div>
            <div class="movepage">
                <a href="index.html" id="movepagetxt">Already have an account? Log In</a>
            </div>
        </form>
    </div>

    <script>
        document.getElementById("signupbtn").addEventListener("click", async function () {
            const username = document.getElementById("userfield").value;
            const password = document.getElementById("psswrdfield").value;
            const confirmPassword = document.getElementById("psswrdconfirm").value;
            const errorMessage = document.getElementById("errorMessage");

            // Validar si los campos están vacíos
            if (!username || !password || !confirmPassword) {
                errorMessage.textContent = "Por favor, completa todos los campos.";
                errorMessage.style.display = "block";
                return;
            }

            // Validar si las contraseñas coinciden
            if (password !== confirmPassword) {
                errorMessage.textContent = "Las contraseñas no coinciden.";
                errorMessage.style.display = "block";
                return;
            }

            try {
                // Enviar solicitud al backend
                const response = await fetch("/auth/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password }),
                });

                const data = await response.json();

                // Manejar la respuesta del backend
                if (data.error) {
                    errorMessage.textContent = data.error;
                    errorMessage.style.display = "block";
                } else {
                    alert("Registro exitoso. Redirigiendo al login...");
                    window.location.href = "index.html"; // Redirigir al login
                }
            } catch (error) {
                console.error("Error:", error);
                errorMessage.textContent = "Error en el servidor.";
                errorMessage.style.display = "block";
            }
        });
    </script>
</body>
</html>
