<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable = no, width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Smooch+Sans:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="logstyle.css">
    <title>Login Page</title>
    
</head>
<body class="body_Login">
    <div class="container" id="logcont">
        <h1 id="title">Login</h1>
        <form id="loginForm">
            <div class="user">
                <!-- Campo de Usuario -->
                <input type="email" placeholder="Email ID" id="userfield" required />
            </div>
            <div class="password">
                <!-- Campo de Contraseña -->
                <input type="password" placeholder="Password" id="psswrdfield" required />
            </div>
            <!-- Checkbox para Recordar Usuario -->
            <div class="remember">
                <input type="checkbox" name="remember me" id="remem">
                <label for="remem" id="remelabel">Remember me</label>
                <a href="https://youtu.be/gi_ciYqY0-Q?si=Vinz04SLC4CLY1TS" target="_blank" id="forgottxt">Forgot Password?</a>
            </div>
            <button type="button" id="loginbtn">Login</button> <!-- Cambiado a type="button" -->
            <div class="movepage">
                <a href="signup.html" target="_self" id="movepagetxt">Don't have an account? Register</a>
            </div>
            <div id="errorMessage" class="error-message"></div>
        </form>
    </div>

    <script>
        document.getElementById("loginbtn").addEventListener("click", async function () {
            const username = document.getElementById("userfield").value;
            const password = document.getElementById("psswrdfield").value;
            const errorMessage = document.getElementById("errorMessage");

            // Validar si los campos están vacíos
            if (!username || !password) {
                errorMessage.textContent = "Por favor, completa ambos campos.";
                errorMessage.style.display = "block";
                return;
            }

            try {
                // Enviar solicitud al backend
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include', // IMPORTANTE para manejar cookies de sesión
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                // Manejar la respuesta del backend
                if (data.error) {
                    errorMessage.textContent = data.error;
                    errorMessage.style.display = "block";
                } else {
                    alert("Inicio de sesión exitoso");
                    window.location.href = "calculator.html"; // Redirigir después del login
                }
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = "Error en el servidor.";
                errorMessage.style.display = "block";
            }
        });
    </script>
</body>
</html>
